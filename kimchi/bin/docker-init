#!/bin/sh

## --- install ---
apt-get update && apt-get -y install curl sudo supervisor

curl -fsSL https://github.com/kimchi-project/kimchi/releases/download/2.5.0/wok-2.5.0-0.noarch.deb -o wok.deb
curl -fsSL https://github.com/kimchi-project/kimchi/releases/download/2.5.0/kimchi-2.5.0-0.noarch.deb -o kimchi.deb

## --- systemctl ---
rm -rf /bin/systemctl
cat >/bin/systemctl <<EOL
#!/bin/sh
echo "active"
exit 0
EOL
chmod +x /bin/systemctl

## --- mockup ---
mkdir -p /run/user
mkdir -p /var/run/libvirt/
touch /var/run/libvirt/libvirt-sock

dpkg -i wok.deb kimchi.deb 2>/dev/null
apt-get -fy install

## --- config ---
sed -i 's/^#session_timeout = .*/session_timeout = 60/g' /etc/wok/wok.conf

## --- mobile navbar-toggle ---
sed -i 's/data-target="#nav-menu"/data-target=".navbar-collapse"/g' /usr/share/wok/ui/pages/wok-ui.html.tmpl

## --- remove self ---
rm -- "$0"

## EOF
